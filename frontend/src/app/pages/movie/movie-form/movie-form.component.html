<ion-header>
    <ion-toolbar>
        <ion-title *ngIf="isNew">Add New Movie</ion-title>
        <ion-title *ngIf="!isNew">Edit Movie</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content *ngIf='movie'>
    <form (ngSubmit)="saveMovie">
        <ion-item>
            <ion-label stacked>Title:</ion-label>
            <ion-input [(ngModel)]="movie.title" [disabled]="!auth.can('patch:movies') || !auth.can('post:movies')"
                       name="title" placeholder="movie Title"
                       required type='text'></ion-input>

        </ion-item>
        <ion-text *ngIf="errors && errors.title" color="danger">{{errors.title}}</ion-text>
        <ion-item stacked>
            <ion-label>Release Date</ion-label>
            <ion-datetime [(ngModel)]="movie.release_date" displayFormat="MMM DD, YYYY" name='release_date'
                          pickerFormat="YYYY-MM-DD"
                          placeholder="Select Date"></ion-datetime>
        </ion-item>
        <ion-text *ngIf="errors && errors.release_date" color="danger">{{errors.release_date}}</ion-text>

        <ion-item>
            <ion-label stacked>Search Actors:</ion-label>
            <ion-input [(ngModel)]="actorFilter"
                       name="actorFilter" placeholder="Actor" type='text'

                       value=""></ion-input>
        </ion-item>
        <ion-item-group *ngIf="actorFilter">
            <ion-item *ngFor="let actor of filteredActors">
                <ion-label>  {{actor.name | uppercase}}</ion-label>
                <ion-button (click)="addActor(actor)"> Add actor</ion-button>
            </ion-item>
        </ion-item-group>
        <ion-text *ngIf="errors && errors.actors" color="danger">{{errors.actors}}</ion-text>

        <ion-grid *ngIf="movie && movie.actors" class="table">
            <ion-row>
                <ion-col>Actor</ion-col>
                <ion-col size="2">Remove</ion-col>
            </ion-row>
            <ion-row *ngFor="let actor of movie.actors; let i = index; trackBy: customTrackBy">
                <ion-col>
                    <ion-text>{{actor.name}}</ion-text>
                    <ion-input [(ngModel)]="actor.id" [name]="'Actor id'+i" hidden
                               type="number"></ion-input>
                </ion-col>

                <ion-col size="2">
                    <ion-button (click)="removeActor(i)" [disabled]="i==0 && movie.actors.length==5">Remove</ion-button>

                </ion-col>
            </ion-row>

        </ion-grid>

        <ion-button (click)="deleteClickedMovie()" [disabled]="isNew || !auth.can('delete:movies')" color="danger">
            Delete
        </ion-button>
        <ion-button (click)="closeModal()">Cancel</ion-button>

        <ion-button (click)="saveMovie()" [disabled]="!auth.can('patch:movies') || !auth.can('post:movies')"
                    color="secondary"
                    type="submit">
            <ion-icon name="save" slot="icon-only"></ion-icon>
            Save
        </ion-button>
    </form>
</ion-content>
